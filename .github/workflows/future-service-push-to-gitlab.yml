name: "ðŸ§ªUpdate GitLab's Future-Service GTFSðŸšŒ"
run-name: ðŸ§ªUpdate GitLab's Future-Service GTFSðŸšŒ
on:
  push:
    branches: [ main ]
    paths:
      - future-service/**.zip
  workflow_dispatch:

jobs:
  validating-gtfs-and-commit-to-gitlab:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
        lfs: false

    - name: Push future service to Gitlab
      run: |
        echo Starting to push repo to gitlab
        git config --global user.name 'GitHub Action'
        git config --global user.email 'action@github.com'
        git config pull.rebase true
        git lfs fetch --all
        git remote add gitlab "https://oauth2:${token}@gitlab.com/LACMTA/gtfs-bus-dev.git"
        git pull
        git push gitlab main
      env: 
        token: ${{ secrets.LACMTA_GITLAB_ACCESS_TOKEN }}